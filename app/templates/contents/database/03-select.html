{% extends 'base.html' %}

{% block title %} PostgreSQL {% endblock %}

{% block header %} SELECT {% endblock %}

{% block content %}
<section>
<h3>SELECT 문법</h3>
<h4>끝에 \G하면 row 단위로 보여줌</h4>
<h4>explain; 세부 정보를 보여줌</h4>
<pre>explain select * from abc\G;</pre>

<!-- ############## 선택자 #########################-->
<h3>선택자 종류</h3>
<pre>=, >, < , > , <=, >=
<>        Not equal. may be written as !=
BETWEEN   Between a certain range(inclusive)
LIKE      Search for a pattern(wildcard: %, _)
IN        To specify multiple possible values for a column
LIMIT     Used to specify the number of records to return
OR, AND, NOT
IS NULL, IS NOT NULL</pre>
<!-- ############## where #########################-->
<h4>WHERE</h4>
  <pre>SELECT column1, column2 FROM table_name WHERE condition;

SELECT * FROM Customers WHERE Country='Mexico' AND email IS NOT NULL;
SELECT * FROM Customers WHERE Country='Mexico' AND City='Mexico City';
SELECT * FROM Customers WHERE Country='Mexico' OR Country='USA';
SELECT * FROM Customers WHERE Country='Mexico' OR country LIKE 'United%';
SELECT * FROM Customers WHERE CustomerID < 10;
-- BETWEEN 시작끝 포함
SELECT * FROM Customers WHERE CustomerID BETWEEN 10 AND 19; 
SELECT * FROM Customers WHERE City IN ('Paris','London');</pre>
<!-- ############## and, or #########################-->
<h4>AND, OR</h4>
<pre>SELECT * FROM customer
  WHERE country = 'Germany' AND (name LIKE 'R%' OR name LIKE 'E%');
SELECT * FROM Customer
  WHERE City = 'Berlin' OR name LIKE 'G%' OR Country = 'Norway'; </pre>
<!-- ############## not #########################-->
<h4>NOT</h4>
<pre>SELECT * FROM customer WHERE NOT country = 'Germany';
SELECT * FROM customer WHERE country NOT LIKE 'G%';
SELECT * FROM customer WHERE id NOT BETWEEN 10 AND 22;
SELECT * FROM customer WHERE city NOT IN('Paris', 'London');
SELECT country, city FROM customer WHERE city NOT IN('Paris', 'London', 'Tulle') 
  AND country NOT IN('Germany', 'France');</pre>
<!-- ############## in #########################-->
<h4>IN</h4>
<pre>SELECT * FROM Customers WHERE Country IN ('Germany', 'France', 'UK');</pre>
<!-- ############## order by #########################-->
<h4>ORDER BY</h4>
  <pre>SELECT column1, ... FROM table_name ORDER BY column1, column2, ... ASC|DESC;
SELECT * FROM Customers ORDER BY Country ASC, CustomerName DESC;  </pre>
<!-- ############## null #########################-->
<h4>NULL</h4>
<pre>SELECT * FROM Customer WHERE City IS NULL;
  SELECT * FROM Customer WHERE City IS NOT NULL;</pre>
<!-- ############## intersect #########################-->
<h4>INTERSECT: 공통으로 적용되는 범위를 보여줌</h4>
<pre>select * from employees where office_id >3  
intersect 
select * from employees where salary < 60000;</pre>
<!-- ############## except #########################-->
<h4>EXCEPT: 첫번째 쿼리에서 두번째 쿼리의 결과를 제외함</h4>
<pre>select * from employees where office_id > 3 
except
select * from employees where salary < 60000;</pre>
<!-- ############## limit #########################-->
<h4>LIMIT</h4>
<pre>SELECT * FROM Customers LIMIT 5; -- 처음 5개만
SELECT * FROM Customers OFFSET 10 LIMIT 5; -- 11번째부터 5개
SELECT * FROM Customers 5, 10; -- 6번째부터 10개</pre>

<!-- ############## sub query        #########################-->
<h3>Subquery</h3>
<h4>Subquery는 쿼리 안에 또 다른 쿼리를 넣는 것</h4>
<pre>SELECT column_name(s) FROM table_name
  WHERE column_name operator
  (SELECT column_name FROM table_name WHERE condition);</pre>
<h4>Subquery는 SELECT, INSERT, UPDATE, DELETE 문에서 사용 가능</h4>
<pre> SELECT first_name, last_name, salary FROM employees 
  WHERE salary > (SELECT AVG(salary) from employees);
SELECT first_name, last_name FROM employees 
  WHERE employee_id IN
  (SELECT DISTINCT customer_id FROM transactions
  WHERE customer_id IS NOT NULL);</pre>
<pre>SELECT categoryId, CategoryName,
  (select max(price) from products p where c.CategoryId = p.CategoryID) as CatMax,
  (select avg(price) from products p where c.CategoryId = p.CategoryID) as Cat평균
from categories c;</pre>

<!-- ############## exists, any, all #########################-->
<h3>EXISTS</h3>
<h5>if true return value</h5>
<h5>The EXISTS operator is used to test for the existence of any record in a subquery.</h5>
<pre>SELECT column_name(s) FROM table_name
  WHERE EXISTS (SELECT column_name(s) FROM table_name WHERE condition);
SELECT SupplierName FROM suppliers
  WHERE EXISTS (SELECT name FROM product 
  WHERE product.supplierID = suppliers.supplierID
  AND Price < 20);</pre>

<h3>ANY</h3>
<pre>SELECT ProductName FROM Products
WHERE ProductID = ANY
  (SELECT ProductID FROM OrderDetails
  WHERE Quantity = 10);
SELECT name FROM product
  WHERE id = ANY -- WHERE ID IN 과 동일
  ( SELECT order_id FROM orders WHERE quantity < 4);</pre>

<h3>ALL</h3>
<pre>SELECT name FROM product
  WHERE id = ALL 
  ( SELECT order_id FROM orders WHERE quantity < 14);</pre>  
</section>

<section>
<h2>Wildcard</h2>
    <h3>wildcard characters</h3>
    <h5>  %	: 0개 이상의 문자<br/>
   _ : 한개의 문자<br/>
   [charlist]	: 안에 들거간 것중 한개(for example, [a-f])(psql 미지원)<br/>
  [^charlist] : 안에 것을 포함하지 않음(for example, [^a-f])(psql 미지원)<br/>
 ^ : not(psql 미지원)<br/>
 {} : 특수 문자(psql 미지원)</h5>

  <h4>REGEXP도 가능 : '^' 시작, '$' 끝, 'w' w포함, '^.....$' 5글자, '^.{5}$' 5글자</h4>
  <p>SELECT * FROM Customers
  WHERE CustomerName REGEXP '^a'; -- a로 시작하는 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP 'a$'; -- a로 끝나는 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP 'a|b'; -- a 또는 b가 포함된 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP '^[a-zA-Z]'; -- 알파벳으로 시작하는 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP '^[0-9]'; -- 숫자로 시작하는 모든 고객을 반환합니다.</p>
<!-- ################ LIKE ################# -->
<h3>LIKE</h3>
<pre>SELECT * FROM Customers
  WHERE CustomerName LIKE 'a%';
SELECT * FROM Customers
  WHERE CustomerName LIKE 'a_%';</pre>
    <h3>The _ wildcard represents a single character.</h3>
<pre>SELECT * FROM Customers
WHERE city LIKE 'L_nd__';</pre>


 <h4>% Wildcard</h4>
<pre>-- a 또는 b로 시작하는 모든 고객을 반환합니다:
SELECT * FROM Customers
WHERE CustomerName LIKE 'a%' OR CustomerName LIKE 'b%';

SELECT * FROM Customers WHERE CustomerName LIKE 'b%s';

SELECT * FROM Customers WHERE CustomerName LIKE '%or%';

SELECT * FROM Customers WHERE hire_date LIKE '____-01-__%'; -- 1월 찾기
SELECT * FROM Customers WHERE CustomerName LIKE 'a__%';
SELECT * FROM Customers WHERE CustomerName LIKE '_r%';

/**
 * IN, NOT IN, BETWEEN, NOT BETWEEN
 * IN은 특정 값이 있는지 확인하는 것
 * BETWEEN은 범위에 있는지 확인하는 것
 */</pre>

<h3>IN</h3>
<pre>SELECT * FROM Customers
WHERE City IN ('Berlin', 'London');</pre>

<h4>NOT IN</h4>
<pre>SELECT * FROM Customers
WHERE City NOT IN ('Berlin', 'London');</pre>

<h4>IN (SELECT)</h4>
<pre>다른 테이블에서 값을 가져오는 경우
SELECT * FROM Customers
WHERE City IN (SELECT City FROM Suppliers);</pre>

<h4>NOT IN (SELECT)</h4>
<pre>SELECT * FROM Customers
  WHERE City NOT IN (SELECT City FROM Suppliers);
  SELECT * FROM product
  WHERE product.id NOT IN (SELECT quantity FROM order_detail);</pre>

<h3>BETWEEN</h3>
<pre>SELECT * FROM Customers WHERE City BETWEEN 'Berlin' AND 'London';</pre>

<h4>NOT BETWEEN</h4>
<pre>SELECT * FROM Products WHERE Price NOT BETWEEN 10 AND 20;</pre>

<h4>BETWEEN with IN</h4>
<pre>SELECT * FROM Products WHERE Price BETWEEN 10 AND 20
  AND CategoryID IN (1,2,3);</pre>

<h4>BETWEEN Text Values</h4>  
<pre>SELECT * FROM Products
  WHERE ProductName BETWEEN 'Carnarvon Tigers' AND 'Mozzarella di Giovanni'
  ORDER BY ProductName;
SELECT * FROM Products
  WHERE ProductName NOT BETWEEN 'Carnarvon Tigers' AND 'Mozzarella di Giovanni'
  ORDER BY ProductName;</pre>

<h4>BETWEEN with Date Values</h4>
<pre>SELECT * FROM Orders
  WHERE OrderDate BETWEEN '1996-07-04' AND '1996-07-08';</pre>

<h3>Aliases</h3>
<h4>대부분 AS를 빼도 됨</h4>
<pre>SELECT ProductName AS Product, Price AS Cost
  FROM Products
  WHERE Price BETWEEN 10 AND 20;
SELECT ProductName Product, Price Cost
  FROM Products
  WHERE Price BETWEEN 10 AND 20;
SELECT ProductName AS "My Great Products" FROM Products; </pre>

<h4>Concatenate Columns</h4>
<pre>SELECT name , address +',' + city+',' + country address
  FROM customer; // 이거 잘안됨
SELECT name , CONCAT(address,',' ,city,',', country) AS address
  FROM customer;</pre>
  
<h4>Alias for Tables</h4>
<pre>SELECT o.OrderID, o.OrderDate, c.CustomerName
  FROM Customers AS c, Orders AS o
  WHERE c.CustomerName='Around the Horn' AND c.CustomerID=o.CustomerID;
SELECT c.name, o.price, c.address
  FROM customer c, order_detail o
  WHERE c.id = o.id;</pre>
</section>
{% endblock %}